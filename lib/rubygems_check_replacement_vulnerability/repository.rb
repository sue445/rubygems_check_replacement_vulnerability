module RubygemsCheckReplacementVulnerability
  class Repository
    include ShellMethods

    attr_reader :repo_url, :work_dir

    def initialize(repo_url, work_dir)
      @repo_url = repo_url
      @work_dir = work_dir
    end

    def git_clone
      Dir.chdir(@work_dir) do
        run("git clone #{@repo_url} . --quiet")
      end
    end

    def tags
      return @tags if @tags

      tags = []

      Dir.chdir(@work_dir) do
        stdout = `git tag`

        stdout.each_line do |line|
          tags << line.strip
        end
      end

      @tags = tags
    end

    def checkout(hash)
      Dir.chdir(@work_dir) do
        run("git checkout #{hash} --quiet")
      end
    end

    def find_file(file)
      Pathname.new(File.join(@work_dir, file))
    end
  end
end
