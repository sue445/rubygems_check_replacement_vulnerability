module RubygemsCheckReplacementVulnerability
  class Repository
    def initialize(repo_url, work_dir)
      @repo_url = repo_url
      @work_dir = work_dir
    end

    def git_clone
      Dir.chdir(@work_dir) do
        run("git clone #{@repo_url} . --quiet")
      end
    end

    def tags
      tags = []

      Dir.chdir(@work_dir) do
        stdout = `git tag`

        stdout.each_line do |line|
          tags << line.strip
        end
      end

      tags
    end

    def checkout(hash)
      Dir.chdir(@work_dir) do
        run("git checkout #{hash} --quiet")
      end
    end

    private

    def run(command)
      ret = system(command)
      raise FailedCommandError, "Failed: #{command}" unless ret
    end
  end
end
