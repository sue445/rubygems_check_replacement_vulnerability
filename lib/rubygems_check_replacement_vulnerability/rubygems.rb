module RubygemsCheckReplacementVulnerability
  require "open-uri"
  require "json"

  class Rubygems
    VULNERABLE_TERMS = Time.parse("2014-11-11") .. Time.parse("2015-02-08")

    def initialize(gem_name)
      @gem_name = gem_name
    end

    def vulnerable_versions
      all_gems = JSON.parse(open("https://rubygems.org/api/v1/versions/#{@gem_name}.json").read)
      vulnerable_gems = all_gems.select do |gem|
        created_at = Time.parse(gem["created_at"])
        VULNERABLE_TERMS.include?(created_at)
      end

      vulnerable_gems.map{ |gem| gem["number"] }
    end
  end
end
