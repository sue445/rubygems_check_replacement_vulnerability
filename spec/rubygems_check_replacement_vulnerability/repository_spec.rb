describe RubygemsCheckReplacementVulnerability::Repository do
  include_context "uses temp dir"

  let(:repository) { RubygemsCheckReplacementVulnerability::Repository.new(repo_url, work_dir) }
  let(:repo_url)   { "git://github.com/sue445/rubicure.git" }
  let(:work_dir)   { temp_dir }

  describe "#git_clone" do
    subject! { repository.git_clone }

    it_is_asserted_by { File.exists?("#{work_dir}/rubicure.gemspec") }
  end

  describe "#tags" do
    subject { repository.tags }

    before do
      repository.git_clone
    end

    it { should include "v0.1.4" }
  end

  describe "#find_version_tag" do
    subject { repository.find_version_tag(version) }

    let(:version) { "0.0.2" }

    before do
      allow(repository).to receive(:tags){ tags }
    end

    context "with prefix v" do
      let(:tags) { ["v0.0.1", "v0.0.2", "v0.0.3"]}

      it { should eq "v0.0.2" }
    end

    context "without prefix v" do
      let(:tags) { ["0.0.1", "0.0.2", "0.0.3"]}

      it { should eq "0.0.2" }
    end
  end

  describe "#checkout" do
    before do
      repository.git_clone
    end

    subject! { repository.checkout(hash) }

    let(:hash) { "v0.1.4" }

    it_is_asserted_by { File.read("#{work_dir}/lib/rubicure/version.rb").include?(%q{VERSION = "0.1.4"}) }
  end
end
