describe RubygemsCheckReplacementVulnerability::CLI do
  subject { RubygemsCheckReplacementVulnerability::CLI.start(args) }

  let(:args) { [command] }

  describe "#vulnerable_gems" do
    let(:command) { "vulnerable_gems" }

    let(:args) { [command, "--username=sue445", "--format=plain"] }
    let(:expected) do
      <<-EOS
sue445's vulnerable gems
- faker-precure : 0.0.2, 0.0.3
- fluent-plugin-out_chatwork : 0.0.1, 0.0.2, 0.0.3
- pebbles-tokyu_ruby_kaigi : 0.0.2
- rspec-every_item : 0.0.1
- rspec-parameterized : 0.1.2
- rspec-temp_dir : 0.0.1, 0.0.2, 0.0.3
      EOS
    end

    it { expect { subject }.to output(expected).to_stdout }
  end

  describe "#verify_gem" do
    let(:command) { "verify_gem" }

    let(:args) { [command, "--name=faker-precure", "--version=0.0.3", "--repo-url=git://github.com/sue445/faker-precure.git"] }

    before do
      allow_any_instance_of(RubygemsCheckReplacementVulnerability::CLI).to receive(:failure_exit)
    end

    it { expect { subject }.to output(/^\[Info\] faker-precure 0\.0\.3 is safe!$/).to_stdout }
  end
end
